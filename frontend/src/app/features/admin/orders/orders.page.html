<app-toast-container />
<app-admin-header title="Billing / Orders"></app-admin-header>

<div class="h-full flex flex-col min-h-0 px-2 pb-3 md:px-0">
  <div class="min-h-0 grow border rounded overflow-hidden bg-white">
    <!-- Filters -->
    <div class="px-3 py-3 border-b flex flex-col gap-3 md:flex-row md:items-end">
      <div class="w-full md:w-auto">
        <label class="block text-xs text-slate-600">Search (student/email)</label>
        <input
          class="border rounded px-2 py-1 w-full md:w-64"
          [formControl]="filters.controls.q"
          placeholder="e.g. alice@example.com">
      </div>

      <div class="w-full md:w-auto">
        <label class="block text-xs text-slate-600">Status</label>
        <select
          class="border rounded px-2 py-1 w-full md:w-44"
          [formControl]="filters.controls.status">
          <option value="">Any</option>
          <option value="STATUS_PENDING">Pending</option>
          <option value="STATUS_PAID">Paid</option>
          <option value="STATUS_FAILED">Failed</option>
        </select>
      </div>

      <div class="w-full md:w-auto">
        <label class="block text-xs text-slate-600">Provider</label>
        <select
          class="border rounded px-2 py-1 w-full md:w-44"
          [formControl]="filters.controls.provider">
          <option value="">Any</option>
          <option value="stripe">Stripe</option>
        </select>
      </div>

      <div class="mt-2 md:mt-0 md:ml-auto w-full md:w-auto flex justify-stretch md:justify-end">
        <button
          *ngIf="isFiltered()"
          class="btn btn-outline w-full md:w-auto"
          (click)="reset()">
          Clear
        </button>
      </div>
    </div>

    <!-- Table -->
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 border-b sticky top-0 z-10">
        <tr>
          <th class="text-left px-3 py-2 w-16 hidden sm:table-cell">ID</th>
          <th class="text-left px-3 py-2 w-48">Created</th>
          <th class="text-left px-3 py-2">Student</th>
          <th class="text-left px-3 py-2 hidden md:table-cell">Class</th>
          <th class="text-left px-3 py-2 w-32 hidden md:table-cell">Amount</th>
          <th class="text-left px-3 py-2 w-24">Status</th>
          <th class="text-left px-3 py-2 w-24 hidden sm:table-cell">Provider</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let o of items()" class="border-b hover:bg-slate-50">
          <td class="px-3 py-2 hidden sm:table-cell">
            {{ o.id }}
          </td>
          <td class="px-3 py-2">
            {{ o.createdAt | date:'medium' }}
          </td>
          <td class="px-3 py-2">
            {{ o.student.firstName }} {{ o.student.lastName }}
            <div class="text-xs text-slate-500">
              {{ o.student.email }}
            </div>
            <div class="text-xs text-slate-500 md:hidden mt-1">
              <span *ngIf="o.classroomName; else cidMobile">
                {{ o.classroomName }}
              </span>
              <ng-template #cidMobile>#{{ o.classroomId }}</ng-template>
              Â· {{ asAmount(o.amountCents, o.currency) }}
            </div>
          </td>
          <td class="px-3 py-2 hidden md:table-cell">
            <span *ngIf="o.classroomName; else cid">
              {{ o.classroomName }}
            </span>
            <ng-template #cid>#{{ o.classroomId }}</ng-template>
          </td>
          <td class="px-3 py-2 hidden md:table-cell">
            {{ asAmount(o.amountCents, o.currency) }}
          </td>
          <td class="px-3 py-2">
            <span class="inline-flex items-center gap-1">
              <span
                class="h-2.5 w-2.5 rounded-full"
                [class.bg-emerald-500]="o.status==='STATUS_PAID'"
                [class.bg-amber-500]="o.status==='STATUS_PENDING'"
                [class.bg-rose-500]="o.status==='STATUS_FAILED'">
              </span>
              {{ o.status.replace('STATUS_', '') }}
            </span>
          </td>
          <td class="px-3 py-2 hidden sm:table-cell">
            {{ o.provider }}
          </td>
        </tr>

        <tr *ngIf="!items().length">
          <td [attr.colspan]="7" class="px-3 py-6 text-center text-slate-500">
            No orders found
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
