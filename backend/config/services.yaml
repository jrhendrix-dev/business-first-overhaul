# config/services.yaml
parameters: { }

services:

    # -- Specific wiring (example)
    App\Controller\ContactController:
        arguments:
            $contactLimiter: '@limiter.contact_form'

    # Aliases to framework limiters (if you use them)
    contact_form.limiter: '@limiter.contact_form'
    forgot_ip.limiter: '@limiter.forgot_ip'
    forgot_email.limiter: '@limiter.forgot_email'

    # Defaults
    _defaults:
        autowire: true
        autoconfigure: true

    # Auto-register everything in src/ except these
    App\:
        resource: '../src/'
        exclude:
            - '../src/DependencyInjection/'
            - '../src/Entity/'
            - '../src/Dto/'
            - '../src/Kernel.php'
            - '../src/**/Tests/'

    # Domain ports/adapters
    App\Mapper\Response\Contracts\ClassroomResponsePort: '@App\Mapper\Response\ClassroomResponseMapper'
    App\Service\Contracts\EnrollmentPort: '@App\Service\EnrollmentManager'
    App\Service\Contracts\GradePort: '@App\Service\GradeManager'
    App\Mapper\Response\Contracts\StudentClassroomResponsePort: '@App\Mapper\Response\StudentClassroomResponseMapper'

    App\Service\Contracts\PasswordResetTokenPort:
        class: App\Service\Adapters\PasswordResetTokenDoctrinePort
        arguments:
            - '@App\Repository\PasswordResetTokenRepository'

    # Account mailer – only its own arguments live here
    App\Service\AccountMailer:
        arguments:
            $fromAddress: '%env(MAILER_FROM)%'
            $mailtrapLimiter: '@limiter.mailtrap_per_second'   # <— inject the factory

    # API exception → JSON envelope (uses Response::HTTP_* codes)
    App\EventSubscriber\ApiExceptionSubscriber:
        arguments:
            $debug: '%kernel.debug%'
        tags: ['kernel.event_subscriber']

